From 3deffe82c8e430c9d4e30d46cd77428d021afee5 Mon Sep 17 00:00:00 2001
From: Wiktor Ogrodnik <wogrodnik@internships.antmicro.com>
Date: Fri, 24 Mar 2023 15:01:57 +0100
Subject: [PATCH] linux dts patches

Remove MMC from DTS
Expand device tree
Add virtio to device tree
Remove default GPIO devices
---
 .../boot/dts/sifive/hifive-unleashed-a00.dts  | 24 +++++++------------
 1 file changed, 9 insertions(+), 15 deletions(-)

diff --git a/arch/riscv/boot/dts/sifive/hifive-unleashed-a00.dts b/arch/riscv/boot/dts/sifive/hifive-unleashed-a00.dts
index 900a50526d77..963b59fbbb85 100644
--- a/arch/riscv/boot/dts/sifive/hifive-unleashed-a00.dts
+++ b/arch/riscv/boot/dts/sifive/hifive-unleashed-a00.dts
@@ -27,6 +27,15 @@ memory@80000000 {
 		reg = <0x0 0x80000000 0x2 0x00000000>;
 	};
 
+	soc {
+		virtio@100d0000 {
+			compatible = "virtio,mmio";
+			reg = <0x00 0x100d0000 0x00 0x150>;
+			interrupt-parent = <&plic0>;
+			interrupts = <50>;
+		};
+	};
+
 	hfclk: hfclk {
 		#clock-cells = <0>;
 		compatible = "fixed-clock";
@@ -40,10 +49,6 @@ rtcclk: rtcclk {
 		clock-frequency = <RTCCLK_FREQ>;
 		clock-output-names = "rtcclk";
 	};
-	gpio-restart {
-		compatible = "gpio-restart";
-		gpios = <&gpio 10 GPIO_ACTIVE_LOW>;
-	};
 
 	led-controller {
 		compatible = "pwm-leds";
@@ -108,14 +113,6 @@ flash@0 {
 
 &qspi2 {
 	status = "okay";
-	mmc@0 {
-		compatible = "mmc-spi-slot";
-		reg = <0>;
-		spi-max-frequency = <20000000>;
-		voltage-ranges = <3300 3300>;
-		disable-wp;
-		gpios = <&gpio 11 GPIO_ACTIVE_LOW>;
-	};
 };
 
 &eth0 {
@@ -136,6 +133,3 @@ &pwm1 {
 	status = "okay";
 };
 
-&gpio {
-	status = "okay";
-};
-- 
2.30.2

